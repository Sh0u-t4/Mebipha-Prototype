<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="S·∫£n ph·∫©m thu·ªëc th√∫ y, th·ªßy s·∫£n ch·∫•t l∆∞·ª£ng cao - Mebipha">
    <title>S·∫£n ph·∫©m - Mebipha</title>

    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="components.css">
    <link rel="stylesheet" href="layout.css">
</head>

<body>
    <!-- Header (simplified, same as index.html) -->
    <header class="header" id="header">
        <div class="header-top">
            <div class="container">
                <div class="header-main-row">
                    <!-- Logo -->
                    <div class="header-logo">
                        <a href="index.html" class="logo-link">
                            <img src="images/logo.png" alt="Mebipha Logo" class="logo-img">
                            <div class="logo-text-wrapper">
                                <span class="logo-brand">MEBIPHA</span>
                                <span class="logo-slogan">GI·∫¢I PH√ÅP CHƒÇN NU√îI 4.0</span>
                            </div>
                        </a>
                    </div>

                    <!-- Search Bar -->
                    <div class="header-search">
                        <form class="search-form" onsubmit="handleSearch(event)">
                            <input type="search" class="search-input"
                                placeholder="T√¨m thu·ªëc, ho·∫°t ch·∫•t, ho·∫∑c b·ªánh l√Ω..." id="searchInput">
                            <button type="submit" class="search-btn-custom">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                </svg>
                                T√¨m ki·∫øm
                            </button>
                        </form>
                    </div>

                    <!-- Header Actions -->
                    <div class="header-actions">
                        <a href="#" class="action-item">
                            <div class="action-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="1.5">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                            </div>
                            <span class="action-text">K√ä ƒê∆†N ONLINE</span>
                        </a>
                        <a href="cart.html" class="action-item cart-btn-wrapper">
                            <div class="action-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="1.5">
                                    <circle cx="9" cy="21" r="1"></circle>
                                    <circle cx="20" cy="21" r="1"></circle>
                                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                                </svg>
                                <span class="cart-badge">0</span>
                            </div>
                            <span class="action-text">GI·ªé H√ÄNG</span>
                        </a>

                        <!-- Mobile Menu Button -->
                        <button class="btn-icon mobile-menu-btn md:d-none" onclick="toggleMobileMenu()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="3" y1="6" x2="21" y2="6" />
                                <line x1="3" y1="12" x2="21" y2="12" />
                                <line x1="3" y1="18" x2="21" y2="18" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Bar -->
        <div class="header-nav-bar">
            <div class="container">
                <nav class="main-nav">
                    <a href="index.html" class="main-nav-link">TRANG CH·ª¶</a>
                    <a href="products.html" class="main-nav-link active">C·ª¨A H√ÄNG</a>
                    <a href="diseases.html" class="main-nav-link">TRA C·ª®U B·ªÜNH</a>
                    <a href="news.html" class="main-nav-link">TIN T·ª®C</a>
                    <a href="contact.html" class="main-nav-link">LI√äN H·ªÜ</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-content">
            <div class="mobile-menu-header">
                <span class="font-bold">Menu</span>
                <button class="btn-icon" onclick="toggleMobileMenu()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <nav class="mobile-nav">
                <a href="index.html" class="mobile-nav-link">TRANG CH·ª¶</a>
                <a href="products.html" class="mobile-nav-link">C·ª¨A H√ÄNG</a>
                <a href="diseases.html" class="mobile-nav-link">TRA C·ª®U B·ªÜNH</a>
                <a href="news.html" class="mobile-nav-link">TIN T·ª®C</a>
                <a href="contact.html" class="mobile-nav-link">LI√äN H·ªÜ</a>
                <a href="account.html" class="mobile-nav-link">T√ÄI KHO·∫¢N</a>
            </nav>
        </div>
    </div>

    <!-- Breadcrumb -->
    <div class="container mt-4">
        <div class="breadcrumb">
            <div class="breadcrumb-item"><a href="index.html" class="breadcrumb-link">Trang ch·ªß</a></div>
            <span class="breadcrumb-separator">‚Ä∫</span>
            <div class="breadcrumb-item"><span class="breadcrumb-current">S·∫£n ph·∫©m</span></div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mt-6 mb-8">
        <div style="display: grid; grid-template-columns: 280px 1fr; gap: var(--space-6);">

            <!-- Filters Sidebar -->
            <aside class="filters-sidebar">
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="font-semibold mb-4">B·ªô l·ªçc</h3>

                    <!-- Category Filter -->
                    <div class="mb-6">
                        <h4 class="font-medium mb-3">Danh m·ª•c</h4>
                        <div class="d-flex flex-column gap-2">
                            <label class="form-check">
                                <input type="radio" name="category" value="" checked onchange="applyFilters()">
                                <span class="form-check-label">T·∫•t c·∫£</span>
                            </label>
                            <label class="form-check">
                                <input type="radio" name="category" value="thuoc-thu-y" onchange="applyFilters()">
                                <span class="form-check-label">Thu·ªëc th√∫ y</span>
                            </label>
                            <label class="form-check">
                                <input type="radio" name="category" value="thuoc-tom" onchange="applyFilters()">
                                <span class="form-check-label">Thu·ªëc t√¥m</span>
                            </label>
                            <label class="form-check">
                                <input type="radio" name="category" value="thuoc-ca" onchange="applyFilters()">
                                <span class="form-check-label">Thu·ªëc c√°</span>
                            </label>
                        </div>
                    </div>

                    <!-- Purpose Filter -->
                    <div class="mb-6">
                        <h4 class="font-medium mb-3">C√¥ng d·ª•ng</h4>
                        <div class="d-flex flex-column gap-2">
                            <label class="form-check">
                                <input type="checkbox" value="khang-sinh" onchange="applyFilters()">
                                <span class="form-check-label">Kh√°ng sinh</span>
                            </label>
                            <label class="form-check">
                                <input type="checkbox" value="dieu-tri" onchange="applyFilters()">
                                <span class="form-check-label">ƒêi·ªÅu tr·ªã</span>
                            </label>
                            <label class="form-check">
                                <input type="checkbox" value="dinh-duong" onchange="applyFilters()">
                                <span class="form-check-label">Dinh d∆∞·ª°ng</span>
                            </label>
                            <label class="form-check">
                                <input type="checkbox" value="vitamin-khoang" onchange="applyFilters()">
                                <span class="form-check-label">Vitamin & Kho√°ng</span>
                            </label>
                            <label class="form-check">
                                <input type="checkbox" value="sat-trung" onchange="applyFilters()">
                                <span class="form-check-label">S√°t tr√πng</span>
                            </label>
                        </div>
                    </div>

                    <!-- Price Filter -->
                    <div class="mb-6">
                        <h4 class="font-medium mb-3">Kho·∫£ng gi√°</h4>
                        <div class="d-flex gap-2 mb-4">
                            <input type="number" class="form-input" placeholder="T·ª´" id="minPrice"
                                onchange="applyFilters()">
                            <input type="number" class="form-input" placeholder="ƒê·∫øn" id="maxPrice"
                                onchange="applyFilters()">
                        </div>
                        <div class="d-flex flex-column gap-3">

                            <label class="form-check">
                                <input type="radio" name="priceRange" value="0-100000" onchange="applyPriceRange(this)">
                                <span class="form-check-label">D∆∞·ªõi 100k</span>
                            </label>
                            <label class="form-check">
                                <input type="radio" name="priceRange" value="100000-300000"
                                    onchange="applyPriceRange(this)">
                                <span class="form-check-label">100k - 300k</span>
                            </label>
                            <label class="form-check">
                                <input type="radio" name="priceRange" value="300000-500000"
                                    onchange="applyPriceRange(this)">
                                <span class="form-check-label">300k - 500k</span>
                            </label>
                            <label class="form-check">
                                <input type="radio" name="priceRange" value="500000-999999999"
                                    onchange="applyPriceRange(this)">
                                <span class="form-check-label">Tr√™n 500k</span>
                            </label>
                        </div>
                    </div>

                    <button class="btn btn-outline w-full" onclick="clearFilters()">X√≥a b·ªô l·ªçc</button>
                </div>
            </aside>

            <!-- Product Grid -->
            <main>
                <div class="d-flex justify-between align-center mb-6">
                    <div>
                        <h1 class="text-2xl font-bold mb-2">S·∫£n ph·∫©m</h1>
                        <p class="text-gray-600" id="productCount">ƒêang t·∫£i...</p>
                    </div>
                    <select class="form-select" style="width: 200px;" onchange="applySorting(this.value)">
                        <option value="">S·∫Øp x·∫øp m·∫∑c ƒë·ªãnh</option>
                        <option value="price-asc">Gi√° tƒÉng d·∫ßn</option>
                        <option value="price-desc">Gi√° gi·∫£m d·∫ßn</option>
                        <option value="name-asc">T√™n A-Z</option>
                        <option value="rating">ƒê√°nh gi√° cao</option>
                        <option value="popular">Ph·ªï bi·∫øn nh·∫•t</option>
                    </select>
                </div>

                <div class="product-grid" id="productGrid">
                    <!-- Products will be loaded here -->
                </div>

                <!-- Pagination -->
                <div class="pagination" id="pagination" style="display: none;">
                    <!-- Pagination will be rendered here -->
                </div>
            </main>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2024 Mebipha. T·∫•t c·∫£ c√°c quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="utils.js"></script>
    <script src="data/products.js"></script>
    <script src="main.js"></script>

    <script>
        let currentFilters = {
            category: '',
            purpose: [],
            minPrice: null,
            maxPrice: null,
            keyword: '',
            sortBy: ''
        };

        // Pagination state
        let currentPage = 1;
        let itemsPerPage = 9;

        function applyFilters() {
            const categoryRadio = document.querySelector('input[name="category"]:checked');
            currentFilters.category = categoryRadio ? categoryRadio.value : '';

            const purposeCheckboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            currentFilters.purpose = Array.from(purposeCheckboxes).map(cb => cb.value);

            const minPrice = document.getElementById('minPrice').value;
            const maxPrice = document.getElementById('maxPrice').value;
            currentFilters.minPrice = minPrice ? parseInt(minPrice) : null;
            currentFilters.maxPrice = maxPrice ? parseInt(maxPrice) : null;

            currentPage = 1; // Reset to first page when filters change
            renderProducts();
        }

        function applyPriceRange(radio) {
            // Toggle behavior: if clicking the same radio again, uncheck it
            if (radio.dataset.wasChecked === 'true') {
                radio.checked = false;
                radio.dataset.wasChecked = 'false';
                // Clear price filter
                document.getElementById('minPrice').value = '';
                document.getElementById('maxPrice').value = '';
            } else {
                // Uncheck all other radios and mark this one as checked
                document.querySelectorAll('input[name="priceRange"]').forEach(r => {
                    r.dataset.wasChecked = 'false';
                });
                radio.dataset.wasChecked = 'true';

                // Apply the price range
                if (radio.value) {
                    const [min, max] = radio.value.split('-').map(Number);
                    document.getElementById('minPrice').value = min;
                    document.getElementById('maxPrice').value = max;
                }
            }
            applyFilters();
        }

        function applySorting(sortBy) {
            currentFilters.sortBy = sortBy;
            renderProducts();
        }

        function clearFilters() {
            document.querySelector('input[name="category"][value=""]').checked = true;
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            // Uncheck all price range radios and reset toggle state
            document.querySelectorAll('input[name="priceRange"]').forEach(radio => {
                radio.checked = false;
                radio.dataset.wasChecked = 'false';
            });
            // Clear price inputs
            document.getElementById('minPrice').value = '';
            document.getElementById('maxPrice').value = '';
            currentFilters = {
                category: '',
                purpose: [],
                minPrice: null,
                maxPrice: null,
                keyword: '',
                sortBy: ''
            };
            renderProducts();
        }

        function renderProducts() {
            const allProducts = filterProducts(currentFilters);
            const productGrid = document.getElementById('productGrid');
            const productCount = document.getElementById('productCount');

            productCount.textContent = `T√¨m th·∫•y ${allProducts.length} s·∫£n ph·∫©m`;

            if (allProducts.length === 0) {
                productGrid.innerHTML = `
          <div class="text-center p-8" style="grid-column: 1 / -1;">
            <p class="text-lg text-gray-600 mb-4">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o</p>
            <button class="btn btn-primary" onclick="clearFilters()">X√≥a b·ªô l·ªçc</button>
          </div>
        `;
                document.getElementById('pagination').style.display = 'none';
                return;
            }

            // Calculate pagination
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const products = allProducts.slice(startIndex, endIndex);

            productGrid.innerHTML = products.map(product => `
        <div class="product-card">
          <div class="product-card-img-wrapper">
            <img class="product-card-img" src="${product.image}" alt="${product.name}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22400%22%3E%3Crect fill=%22%2386EFAC%22 width=%22400%22 height=%22400%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22white%22 font-size=%2224%22%3E${product.name.substring(0, 20)}%3C/text%3E%3C/svg%3E'">
          </div>
          <div class="product-card-badge badge badge-${product.animalType.includes('thuy-san') ? 'secondary' : 'primary'}">
            ${product.animalType === 'thuy-san-tom' ? 'T√¥m' : product.animalType === 'thuy-san-ca' ? 'C√°' : 'Gia s√∫c/Giac·∫ßm'}
          </div>

          <div class="product-card-body">
            <div class="product-card-brand">${product.brand}</div>
            <h3 class="product-card-title">${product.name}</h3>
            <div class="product-card-rating">
              <span class="product-card-stars">‚≠ê ${product.rating}</span>
              <span class="text-gray-500">(${product.reviews})</span>
              <button class="product-card-wishlist" onclick="toggleWishlist('${product.id}', event)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="${Wishlist.has(product.id) ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="2">
                  <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                </svg>
              </button>
            </div>
            <div class="product-card-price">
              ${formatPrice(product.price)}
              ${product.oldPrice ? `<span class="product-card-price-old">${formatPrice(product.oldPrice)}</span>` : ''}
            </div>
            <div class="product-card-meta">
              ${product.packaging.slice(0, 3).map(p => `<span class="badge badge-gray">${p}</span>`).join('')}
            </div>
            <div class="product-card-actions">
              <button class="btn btn-primary w-full" onclick="addToCart('${product.id}')">üõí Th√™m v√†o gi·ªè</button>
            </div>
          </div>
        </div>
      `).join('');

            // Render pagination
            renderPagination(allProducts.length);
        }

        // Pagination functions
        function renderPagination(totalProducts) {
            const pagination = document.getElementById('pagination');
            const totalPages = Math.ceil(totalProducts / itemsPerPage);

            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }

            pagination.style.display = 'flex';

            let paginationHTML = '';

            // Previous button
            paginationHTML += `
                <button class="pagination-btn" onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                </button>
            `;

            // Page numbers container
            paginationHTML += '<div class="pagination-numbers">';

            // Generate page numbers with ellipsis
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);

            // Always show first page
            if (startPage > 1) {
                paginationHTML += `<button class="pagination-number ${currentPage === 1 ? 'active' : ''}" onclick="goToPage(1)">1</button>`;
                if (startPage > 2) {
                    paginationHTML += '<span class="pagination-ellipsis">...</span>';
                }
            }

            // Show page numbers
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `<button class="pagination-number ${currentPage === i ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
            }

            // Always show last page
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    paginationHTML += '<span class="pagination-ellipsis">...</span>';
                }
                paginationHTML += `<button class="pagination-number ${currentPage === totalPages ? 'active' : ''}" onclick="goToPage(${totalPages})">${totalPages}</button>`;
            }

            paginationHTML += '</div>';

            // Next button
            paginationHTML += `
                <button class="pagination-btn" onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
            `;

            // Items per page selector
            paginationHTML += `
                <select class="pagination-select" onchange="changeItemsPerPage(this.value)">
                    <option value="9" ${itemsPerPage === 9 ? 'selected' : ''}>9 / page</option>
                    <option value="18" ${itemsPerPage === 18 ? 'selected' : ''}>18 / page</option>
                    <option value="27" ${itemsPerPage === 27 ? 'selected' : ''}>27 / page</option>
                </select>
            `;

            pagination.innerHTML = paginationHTML;
        }

        function goToPage(pageNumber) {
            const allProducts = filterProducts(currentFilters);
            const totalPages = Math.ceil(allProducts.length / itemsPerPage);

            if (pageNumber < 1 || pageNumber > totalPages) return;

            currentPage = pageNumber;
            renderProducts();

            // Scroll to top of product grid
            document.getElementById('productGrid').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function changeItemsPerPage(value) {
            itemsPerPage = parseInt(value);
            currentPage = 1; // Reset to first page
            renderProducts();
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            // Check for search param
            const params = getUrlParams();
            if (params.search) {
                currentFilters.keyword = params.search;
                document.getElementById('searchInput').value = params.search;
            }
            if (params.category) {
                currentFilters.category = params.category;
                const radio = document.querySelector(`input[name="category"][value="${params.category}"]`);
                if (radio) radio.checked = true;
            }

            renderProducts();
        });
    </script>
</body>

</html>